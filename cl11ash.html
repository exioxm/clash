<!DOCTYPE html>
<html>
<head>
    <title>Clash Royale HTML5 - Full Fix</title>
    <style>
        :root { --p-blue: #3498db; --e-red: #e74c3c; --field: #27ae60; }
        body { margin: 0; background: #1a1a1a; display: flex; justify-content: center; font-family: sans-serif; overflow: hidden; }
        
        /* THE ARENA */
        #game-window { width: 360px; height: 640px; background: var(--field); position: relative; border: 5px solid #333; overflow: hidden; }
        .river { position: absolute; top: 50%; width: 100%; height: 40px; background: #2980b9; transform: translateY(-50%); }
        .bridge { position: absolute; width: 60px; height: 50px; background: #7f8c8d; top: 50%; transform: translateY(-50%); }
        
        /* TOWERS & UNITS */
        .entity { position: absolute; width: 40px; height: 40px; border-radius: 5px; display: flex; align-items: center; justify-content: center; font-weight: bold; font-size: 10px; color: white; transition: top 0.5s linear, left 0.5s linear; z-index: 10; }
        .tower { width: 50px; height: 50px; border: 3px solid gold; }
        .player { background: var(--p-blue); box-shadow: 0 0 10px rgba(0,0,0,0.5); }
        .enemy { background: var(--e-red); }
        
        /* UI & DECK */
        #ui-overlay { position: absolute; bottom: 0; width: 100%; height: 120px; background: rgba(0,0,0,0.7); z-index: 20; }
        #elixir-container { width: 90%; height: 15px; background: #444; margin: 10px auto; border-radius: 10px; border: 2px solid #000; }
        #elixir-fill { height: 100%; background: #e056fd; width: 0%; border-radius: 8px; transition: width 0.3s; }
        #cards { display: flex; justify-content: center; gap: 10px; }
        .card { width: 65px; height: 85px; background: #f1c40f; border-radius: 5px; cursor: pointer; border: 2px solid transparent; color: #000; text-align: center; font-size: 12px; }
        .card.selected { border-color: white; transform: scale(1.1); }
        
        /* PLACEMENT GHOST */
        #ghost { pointer-events: none; opacity: 0.5; display: none; }
    </style>
</head>
<body>

<div id="game-window" onclick="handlePlacement(event)">
    <div class="river"></div>
    <div class="bridge" style="left: 50px;"></div>
    <div class="bridge" style="right: 50px;"></div>

    <!-- PRE-PLACED TOWERS -->
    KING</div>
    PRINCE</div>
    PRINCE</div>

    <div id="player-towers">
        KING</div>
    </div>

    <!-- UNIT SPAWNER GHOST -->
    </div>

    <div id="ui-overlay">
        <div id="elixir-container"><div id="elixir-fill"></div></div>
        <div id="cards">
            <div class="card" onclick="selectCard(this, 'Knight', 3)">Knight<br>3ðŸ’§</div>
            <div class="card" onclick="selectCard(this, 'Tower', 4)">Tesla<br>4ðŸ’§</div>
            <div class="card" onclick="selectCard(this, 'Giant', 5)">Giant<br>5ðŸ’§</div>
        </div>
    </div>
</div>

<script>
    let elixir = 5;
    let selectedCard = null;
    const arena = document.getElementById('game-window');

    // Update Elixir every 2 seconds
    setInterval(() => {
        if (elixir < 10) {
            elixir++;
            document.getElementById('elixir-fill').style.width = (elixir * 10) + '%';
        }
    }, 2000);

    function selectCard(el, type, cost) {
        document.querySelectorAll('.card').forEach(c => c.classList.remove('selected'));
        el.classList.add('selected');
        selectedCard = { type, cost };
    }

    function handlePlacement(e) {
        if (!selectedCard) return;
        
        const rect = arena.getBoundingClientRect();
        const x = e.clientX - rect.left - 20;
        const y = e.clientY - rect.top - 20;

        // BUG FIX: Prevent placing in the enemy's half (Top 50% of arena)
        if (y < 320) {
            alert("CAN'T PLACE ON ENEMY SIDE!");
            return;
        }

        if (elixir >= selectedCard.cost) {
            elixir -= selectedCard.cost;
            document.getElementById('elixir-fill').style.width = (elixir * 10) + '%';
            spawnEntity(x, y, selectedCard.type);
            
            // Deselect after placement
            selectedCard = null;
            document.querySelectorAll('.card').forEach(c => c.classList.remove('selected'));
        } else {
            alert("LOW ELIXIR!");
        }
    }

    function spawnEntity(x, y, type) {
        const unit = document.createElement('div');
        unit.className = 'entity player';
        if (type === 'Tower') unit.classList.add('tower');
        unit.style.left = x + 'px';
        unit.style.top = y + 'px';
        unit.innerText = type;
        arena.appendChild(unit);

        // Logic: If it's a mobile unit (Knight/Giant), move toward enemy King
        if (type !== 'Tower') {
            setTimeout(() => {
                unit.style.top = '30px'; // Move to enemy King Y coordinate
                unit.style.left = '160px'; // Move to enemy King X coordinate
            }, 100);
        }
    }
</script>

</body>
</html>
