<!DOCTYPE html>
<html>
<head>
    <title>Clash Royale - Final Bug Fix</title>
    <style>
        :root { --tile: 18px; --w: calc(var(--tile) * 18); --h: calc(var(--tile) * 32); }
        body { margin: 0; background: #000; display: flex; flex-direction: column; align-items: center; font-family: 'Arial Black', sans-serif; color: white; }
        
        /* Fixed Arena Layout */
        #arena { 
            width: var(--w); height: var(--h); background: #27ae60; position: relative; border: 3px solid #fff; margin-top: 10px;
            background-image: linear-gradient(#2ecc71 1px, transparent 1px), linear-gradient(90deg, #2ecc71 1px, transparent 1px);
            background-size: var(--tile) var(--tile);
        }

        .river { position: absolute; top: calc(var(--tile) * 15); width: 100%; height: calc(var(--tile) * 2); background: #2980b9; }
        .bridge { position: absolute; width: calc(var(--tile) * 2); height: calc(var(--tile) * 2); background: #7f8c8d; top: calc(var(--tile) * 15); }

        /* Fixed Tower Positions */
        .tower { position: absolute; display: flex; align-items: center; justify-content: center; font-size: 9px; border: 2px solid gold; border-radius: 4px; z-index: 10; }
        .king { width: calc(var(--tile) * 4); height: calc(var(--tile) * 4); left: calc(var(--tile) * 7); }
        .princess { width: calc(var(--tile) * 3); height: calc(var(--tile) * 3); }

        /* Red Side */
        #e-king { top: var(--tile); background: #e74c3c; }
        #e-p1 { top: calc(var(--tile) * 4); left: calc(var(--tile) * 3); background: #e74c3c; }
        #e-p2 { top: calc(var(--tile) * 4); right: calc(var(--tile) * 3); background: #e74c3c; }

        /* Blue Side */
        #p-king { bottom: var(--tile); background: #3498db; }
        #p-p1 { bottom: calc(var(--tile) * 4); left: calc(var(--tile) * 3); background: #3498db; }
        #p-p2 { bottom: calc(var(--tile) * 4); right: calc(var(--tile) * 3); background: #3498db; }

        /* Centered Deck */
        #deck { margin-top: 10px; display: flex; gap: 8px; background: rgba(0,0,0,0.8); padding: 10px; border-radius: 10px; }
        .card { width: 55px; height: 75px; background: gold; color: black; border-radius: 5px; text-align: center; font-size: 11px; cursor: pointer; border: 2px solid transparent; }
        .card.active { border-color: white; transform: scale(1.05); }
    </style>
</head>
<body>

<div id="arena" onclick="place(event)">
    <div class="river"></div>
    <div class="bridge" style="left: calc(var(--tile) * 3);"></div>
    <div class="bridge" style="right: calc(var(--tile) * 3);"></div>

    <!-- Enemy Towers -->
    <div class="tower king" id="e-king">KING</div>
    <div class="tower princess" id="e-p1">PRINCE</div>
    <div class="tower princess" id="e-p2">PRINCE</div>

    <!-- Player Towers -->
    <div class="tower king" id="p-king">KING</div>
    <div class="tower princess" id="p-p1">PRINCE</div>
    <div class="tower princess" id="p-p2">PRINCE</div>
</div>

<div id="deck">
    <div class="card" onclick="sel('Knight', 3, this)">Knight<br>3ðŸ’§</div>
    <div class="card" onclick="sel('Giant', 5, this)">Giant<br>5ðŸ’§</div>
    <div class="card" onclick="sel('Tesla', 4, this)">Tesla<br>4ðŸ’§</div>
</div>

<script>
    let current = null;
    const tile = 18;

    function sel(t, c, el) {
        document.querySelectorAll('.card').forEach(x => x.classList.remove('active'));
        el.classList.add('active');
        current = { t, c };
    }

    function place(e) {
        if (!current) return;
        const rect = document.getElementById('arena').getBoundingClientRect();
        const x = Math.floor((e.clientX - rect.left) / tile) * tile;
        const y = Math.floor((e.clientY - rect.top) / tile) * tile;

        if (y < (17 * tile)) return alert("RESTRICTED AREA");

        const u = document.createElement('div');
        u.className = 'tower';
        u.style.cssText = `left:${x}px; top:${y}px; width:${tile*2}px; height:${tile*2}px; background:#3498db;`;
        u.innerText = current.t;
        document.getElementById('arena').appendChild(u);
        current = null;
    }
</script>
</body>
</html>
